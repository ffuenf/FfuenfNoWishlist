language: php
php:
- 7.0
- 7.1
- 7.2
sudo: false
services:
- mysql
env:
  matrix:
  - SHOPWARE_VERSION="5.5"
  global:
  - PLUGIN_NAME=FfuenfNoWishlist
  - SHOPWARE_DIRECTORY="${HOME}/shopware"
  - PLUGIN_DIRECTORY="${SHOPWARE_DIRECTORY}/custom/plugins"
cache:
  directories:
  - "${HOME}/.composer/cache/files"
install:
- composer install
before_script:
- if [[ "$(php --version | grep -cim1 xdebug)" -ge 1 ]]; then phpenv config-rm xdebug.ini;
  fi
- git clone https://github.com/shopware/shopware.git ${SHOPWARE_DIRECTORY} --branch
  ${SHOPWARE_VERSION}
- ant -f ${SHOPWARE_DIRECTORY}/build/build.xml -Dapp.host=localhost -Ddb.user=travis
  -Ddb.host=127.0.0.1 -Ddb.name=shopware build-unit
- mv ${TRAVIS_BUILD_DIR} ${PLUGIN_DIRECTORY}/${PLUGIN_NAME}
- php ${HOME}/shopware/bin/console sw:plugin:refresh
- php ${HOME}/shopware/bin/console sw:plugin:install ${PLUGIN_NAME}
- php ${HOME}/shopware/bin/console sw:plugin:activate ${PLUGIN_NAME}
- cd ${PLUGIN_DIRECTORY}/${PLUGIN_NAME}
script:
- composer test
- composer test-spec
after_success:
- "./build.sh $TRAVIS_TAG"
deploy:
  skip_cleanup: true
  provider: releases
  file_glob: true
  file: "${PLUGIN_NAME}*.zip"
  on:
    tags: true
  api_key:
    secure: kh+jGHBv4MoxlJzGl+t2l1g9YIQp02Tw8fs9xzdbu+YAC/ihTFN2RyHz3PQIFE99aIOBnM0jYKxR2+4Eix/FcKSzXX0xRTsE+bb2xUbLWSjoRY6/LRzWPm55b06s5IT9NVotvwL1DFFLEP4sp3cj32D7LfHhY9vlNkIn+qaPnn/q3pDRh7MtTI8uFGTKhu24i0UqPBMuhTA9xHjXgzYVyCR8MN9zjifmfARBLdMdSJJ+fS90W17Oqqp7Z7Py9QbHmSrsyurxvw2DXZlZlO7h51DvLv01xf0Z2+oIN52qeVNNRrdTniLZmOPILuRAWKeIjxe8zZ1ZT3tkxLBVGblebzIlkDTUN+xgOY9wxbqxLIKKm+64V8DsniahU/+mrgCNVDV3MRt/A0LuiQPfNwgA6+BK/s5VKNlBEvxCbmbH7qBzPbHtPc1UJTJpYWyXgV7MukCPn0dF7TAHUG3sivJ5pbgBRSrLYO2terInrqesbPaoafHdPm4kFwfKeO4jwG1LWB0/UvA00iFDBwoPi3gETnyA7JE1EDn3EQsT1ENRdRK/BAO4lMrMEzlQsW5rzIDUpPbMW9HelgeADpqdMTzL+q9zk3/txyN0U1VB6t9W2rQ8TdfLl5WKRBn54i/p3UVWfOr1DAIiUPea3zFH9fVeFctEfWyNcct/Y+zxdI4e36g=
notifications:
  slack:
    secure: j9kHpwAUdHLfDxwFVJBSnqNtqGYCEDGTjN8sD6c7hLbKwe8ylpUbIoJIutBvTZ515pfZ8Ue4K1bZdfsQhyFpKY24Q3TZKnX97N5AcpMbBow+JbCdQvQao9oF8aQXhljr8BDkuq8EmraHQLO9816rz3EU11W62FAanOfNkFE750xx47cgsB6B3qtb/SdDJDiOH9KVqZY573tKVLu3gWF/Hdrx+8Rl5NuUBd80gXU0JHkYywPmbrPV1CId3Olb8/jYTM/1au7PAqWTxKAuoCwNJ0YIgJqTgqWIBm9msA7iiAzRcYdSOqQHzy6fTu3s7fhnYC/xS0j5Kd0Qphd3TAnGc/6qYbIM4VKFOoMnWR8OwRBw0nEhSlEWs0DWw5/xOw6GB5CibhLlLGZQL7JWNoA7TWWwc2g09xy3vlE24i/iodSU+CIp6nPGHAeVfy1oodAcQm3ToMznEJVvndAy4daawLF+CvxEP3Rx9ThAlZd0BQxgwegvcGkqQqoRzHe8GBRsC3ofYeHaa70ia77GHNqzcQTQXXuhXwbC7JApXg7lyZi1U6b1fZrPNtEyyAlbI9Y3lfixDhdbuvHgDcHclGac/l0TzCMzA5yF04y4Ok3Io75/NiyJNA3gxlSMobj1kFoh0AuhPktQl1G/RWMjl0/xJMF5/2On3/5+/+38MPXogaM=
